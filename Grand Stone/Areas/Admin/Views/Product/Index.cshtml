@model IEnumerable<Domain.Entities.Product>

@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Products";
}

<div class="admin-card">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="m-0">Products</h5>

        <a asp-area="Admin" asp-controller="Product" asp-action="Create" class="admin-btn-gold">
            + Add New Product
        </a>
    </div>

    <table class="admin-table">
        <thead>
            <tr>
                <th>Name</th>
                <th style="width:80px;">Image</th>
                <th style="width:140px;">Category</th>
                <th style="width:140px;">Price</th>
                <th style="width:120px;">Available</th>
                <th style="width:200px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="5" class="text-muted">No products yet.</td>
                </tr>
            }
            else
            {
                foreach (var p in Model)
                {
                    <tr>
                        <td>@p.Name</td>
                        <td>
                            <img src="@(string.IsNullOrWhiteSpace(p.ImageUrl) ? "/images/products/p1.jpg" : p.ImageUrl)"
                                 style="width:52px;height:52px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.08);" />
                        </td>
                        <td>@(p.Category?.Name ?? "-")</td>
                        <td>@p.Price.ToString("0.00")</td>
                        <td>@(p.IsAvailable ? "Yes" : "No")</td>
                        <td>
                            <a asp-area="Admin" asp-controller="Product" asp-action="Edit" asp-route-id="@p.Id"
                               class="btn btn-sm btn-outline-light">Edit</a>

                            <form asp-area="Admin"
                                  asp-controller="Product"
                                  asp-action="DeleteConfirmed"
                                  method="post"
                                  class="js-delete-form"
                                  data-name="@p.Name"
                                  style="display:inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@p.Id" />
                                <button type="submit" class="btn btn-sm btn-outline-danger ms-1">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
    @{
        int currentPage = ViewBag.Page ?? 1;
        int totalPages = ViewBag.TotalPages ?? 1;
        int pageSize = ViewBag.PageSize ?? 6;
        var q = ViewBag.Q as string;

        int startPage = currentPage - 2;
        if (startPage < 1) startPage = 1;

        int endPage = currentPage + 2;
        if (endPage > totalPages) endPage = totalPages;
    }

    @if (totalPages > 1)
    {
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="text-muted">
                Page <b>@currentPage</b> of <b>@totalPages</b>
            </div>

            <nav class="gs-pagination">

                <!-- Prev -->
                <a class="pg-btn @(currentPage == 1 ? "disabled" : "")"
                   asp-area="Admin" asp-controller="Product" asp-action="Index"
                   asp-route-q="@q"
                   asp-route-page="@(currentPage - 1)"
                   asp-route-pageSize="@pageSize">
                    Prev
                </a>

                <!-- First -->
                @if (startPage > 1)
                {
                    <a class="pg-num"
                       asp-area="Admin" asp-controller="Product" asp-action="Index"
                       asp-route-q="@q"
                       asp-route-page="1"
                       asp-route-pageSize="@pageSize">1</a>

                    <span class="pg-dots">...</span>
                }

                <!-- Numbers -->
                @for (int i = startPage; i <= endPage; i++)
                {
                    <a class="pg-num @(i == currentPage ? "active" : "")"
                       asp-area="Admin" asp-controller="Product" asp-action="Index"
                       asp-route-q="@q"
                       asp-route-page="@i"
                       asp-route-pageSize="@pageSize">@i</a>
                }

                <!-- Last -->
                @if (endPage < totalPages)
                {
                    <span class="pg-dots">...</span>

                    <a class="pg-num"
                       asp-area="Admin" asp-controller="Product" asp-action="Index"
                       asp-route-q="@q"
                       asp-route-page="@totalPages"
                       asp-route-pageSize="@pageSize">@totalPages</a>
                }

                <!-- Next -->
                <a class="pg-btn @(currentPage == totalPages ? "disabled" : "")"
                   asp-area="Admin" asp-controller="Product" asp-action="Index"
                   asp-route-q="@q"
                   asp-route-page="@(currentPage + 1)"
                   asp-route-pageSize="@pageSize">
                    Next
                </a>

            </nav>
        </div>
    }
</div>
